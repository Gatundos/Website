<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fubá</title>
  <style>
    :root {
      --bg: #0f1220;
      --card: #1b2138;
      --text: #e6e9f2;
      --muted: #a9b1c6;

      --bcc-azul: #5aa6ff;
      --bcc-verde: #35c77a;
      --bcc-laranja: #ffa94d;
      --bcc-vermelho: #ff5a5a;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans";
      background: radial-gradient(1200px 800px at 70% -10%, #1b2138 0%, #0f1220 60%), var(--bg);
      color: var(--text);
      min-height: 100dvh;
      display: grid;
      place-items: start center;
      padding: 24px;
    }

    .container { width: min(1200px, 100%); display: grid; gap: 24px; }
    header h1 { margin: 0; font-size: clamp(1.2rem, 1rem + 1vw, 1.6rem); }
    .legend { color: var(--muted); }

    /* Imagem + botões de modais ao lado */
    .hero-wrap {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      align-items: start;
    }

    .hero {
      background: var(--card);
      border: 1px solid #2a3354;
      border-radius: 16px;
      overflow: clip;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .hero img { display: block; width: 100%; height: auto; aspect-ratio: 16 / 9; object-fit: cover; }
    .hero figcaption { padding: 10px 12px; color: var(--muted); }

    .side-actions { display: grid; gap: 8px; align-content: start; }

    .btn, button.action {
      appearance: none;
      background: #222948;
      color: var(--text);
      border: 1px solid #2c3664;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: transform .04s ease, background .2s ease, border-color .2s ease, color .2s ease;
      text-align: left;
    }
    .btn:hover, button.action:hover { transform: translateY(-1px); background: #27305a; border-color: #3b4a86; }
    .btn:active, button.action:active { transform: translateY(0); }
    .btn:focus-visible, button.action:focus-visible { outline: 2px solid #6ea8fe; outline-offset: 2px; }
    .btn[disabled], button.action[disabled] { cursor: not-allowed; background: #1e243f; color: var(--muted); border-color: #323b66; }

    .panel {
      background: #141a31;
      border: 1px solid #28325a;
      border-radius: 12px;
      padding: 14px 16px;
      min-height: 56px;
      display: grid;
      align-content: center;
      line-height: 1.4;
    }
    .panel .title { color: var(--muted); font-size: 0.9rem; margin-bottom: 4px; }
    .panel .message { color: var(--text); font-size: 1rem; }

    .toolbar { display: grid; gap: 16px; }
    .row { display: grid; grid-template-columns: auto 1fr auto; gap: 12px; align-items: center; }
    .row .label { color: var(--muted); font-size: 0.95rem; }

    progress { width: 100%; height: 16px; appearance: none; -webkit-appearance: none; }
    progress::-webkit-progress-bar { background: #1e2747; border-radius: 8px; }
    progress::-webkit-progress-value { background: #6ea8fe; border-radius: 8px; }
    progress::-moz-progress-bar { background: #6ea8fe; border-radius: 8px; }

    .bcc.bcc-azul::-webkit-progress-value { background: var(--bcc-azul); }
    .bcc.bcc-azul::-moz-progress-bar { background: var(--bcc-azul); }
    .bcc.bcc-verde::-webkit-progress-value { background: var(--bcc-verde); }
    .bcc.bcc-verde::-moz-progress-bar { background: var(--bcc-verde); }
    .bcc.bcc-laranja::-webkit-progress-value { background: var(--bcc-laranja); }
    .bcc.bcc-laranja::-moz-progress-bar { background: var(--bcc-laranja); }
    .bcc.bcc-vermelho::-webkit-progress-value { background: var(--bcc-vermelho); }
    .bcc.bcc-vermelho::-moz-progress-bar { background: var(--bcc-vermelho); }

    .counter { font-variant-numeric: tabular-nums; }
    .actions-inline { display: grid; grid-auto-flow: column; gap: 8px; }

    .controls { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); }

    /* Dialogs */
    dialog.side, dialog.modal {
      width: min(520px, 92vw);
      border: 1px solid #3a4371;
      border-radius: 12px;
      padding: 0;
      color: var(--text);
      background: #131833;
    }
    dialog.side::backdrop, dialog.modal::backdrop { background: rgba(0,0,0,.4); }
    .dialog-head {
      padding: 12px 16px;
      border-bottom: 1px solid #2a3354;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .dialog-title { margin: 0; font-size: 1rem; }
    .dialog-body { padding: 16px; display: grid; gap: 12px; }
    .dialog-body textarea {
      width: 100%;
      min-height: 160px;
      border-radius: 8px;
      border: 1px solid #2c3664;
      background: #0f1330;
      color: var(--text);
      padding: 10px 12px;
      resize: vertical;
      font-family: inherit;
      font-size: 0.95rem;
    }
    .modal-buttons { display: grid; grid-auto-flow: column; gap: 8px; justify-content: end; }
    .modal-buttons .btn { text-align: center; }

    @media (max-width: 900px) {
      .hero-wrap { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <main class="container" aria-busy="false">
    <header>
      <h1>Habilidades x BCC + Luta + Modais</h1>
      <p class="legend">Quando o cansaço chegar a 20 antes de concluir as habilidades, escolha Hospital ou Derrota.</p>
    </header>

    <!-- Imagem + botões laterais -->
    <section class="hero-wrap">
      <figure class="hero" aria-labelledby="hero-caption">
        <img src="https://gatundos.github.io/Website/images/single-image.jpg" alt="Paisagem principal com montanhas ao fundo" />
        <figcaption id="hero-caption" class="legend">Imagem principal demonstrativa</figcaption>
      </figure>

      <aside class="side-actions" aria-label="Modais de conteúdo">
        <button class="btn" id="openFicha" type="button">Ficha técnica</button>
        <button class="btn" id="openHistoria" type="button">História</button>
        <button class="btn" id="openLocal" type="button">Localidade Encontrado</button>
      </aside>
    </section>
    
<!-- Audio + Video -->
    <section class="Hero-Play">
      
      <aside class="side-actions" aria-label="Modais de conteúdo">
      <audio id="beep" preload="auto">
  <source src="Personagens\Audio\Palavras Antes da Pancadaria.mp3" type="audio/mpeg">
  Seu navegador não suporta o elemento audio.
</audio>

<button id="play">Tocar</button>
<button id="pause">Pausar</button>
<button id="mute">Mutar</button>

<script>
  const audio = document.getElementById('beep');
  document.getElementById('play').addEventListener('click', () => audio.play());
  document.getElementById('pause').addEventListener('click', () => audio.pause());
  document.getElementById('mute').addEventListener('click', () => audio.muted = !audio.muted);
</script>
        
      </aside>
    </section>

    <!-- Mensagens (status) -->
    <section class="panel" role="status" aria-live="polite" aria-atomic="true">
      <div class="title">Mensagem</div>
      <div class="message" id="output">Nada selecionado ainda.</div>
    </section>

    <!-- Barras e comandos -->
    <section class="toolbar" aria-label="Progresso e comandos">
      <div class="row">
        <span class="label" id="skills-label">Barra 1 – Habilidades</span>
        <progress id="progSkills" value="0" max="20" aria-labelledby="skills-label skills-help"></progress>
        <span id="skills-count" class="counter" aria-live="polite">0/20</span>
      </div>
      <div id="skills-help" class="legend">Sobe 1 ponto a cada habilidade usada. Ao chegar a 20, aparece mensagem especial.</div>

      <div class="row">
        <span class="label" id="bcc-label">Barra 2 – BCC (Cansaço)</span>
        <progress id="progBcc" class="bcc bcc-azul" value="0" max="20" aria-labelledby="bcc-label bcc-help"></progress>
        <span id="bcc-count" class="counter" aria-live="polite">0/20</span>
      </div>
      <div id="bcc-help" class="legend">Cores: Azul 1–5, Verde 6–10, Laranja 11–15, Vermelho 16–20. Só altera via Cansaço +1/−1.</div>

      <div class="actions-inline" aria-label="Comandos">
        <button id="inc" class="btn" type="button">Cansaço +1</button>
        <button id="dec" class="btn" type="button">Cansaço -1</button>
        <button id="fight" class="btn" type="button">Luta</button>
        <button id="reset" class="btn" type="button">Reset</button>
      </div>
    </section>

    <!-- 20 habilidades -->
    <section class="controls" aria-label="Habilidades (20 itens)">
      <button class="action" data-msg="Habilidade 1 usada.">Habilidade 1</button>
      <button class="action" data-msg="Habilidade 2 usada.">Habilidade 2</button>
      <button class="action" data-msg="Habilidade 3 usada.">Habilidade 3</button>
      <button class="action" data-msg="Habilidade 4 usada.">Habilidade 4</button>
      <button class="action" data-msg="Habilidade 5 usada.">Habilidade 5</button>
      <button class="action" data-msg="Habilidade 6 usada.">Habilidade 6</button>
      <button class="action" data-msg="Habilidade 7 usada.">Habilidade 7</button>
      <button class="action" data-msg="Habilidade 8 usada.">Habilidade 8</button>
      <button class="action" data-msg="Habilidade 9 usada.">Habilidade 9</button>
      <button class="action" data-msg="Habilidade 10 usada.">Habilidade 10</button>
      <button class="action" data-msg="Habilidade 11 usada.">Habilidade 11</button>
      <button class="action" data-msg="Habilidade 12 usada.">Habilidade 12</button>
      <button class="action" data-msg="Habilidade 13 usada.">Habilidade 13</button>
      <button class="action" data-msg="Habilidade 14 usada.">Habilidade 14</button>
      <button class="action" data-msg="Habilidade 15 usada.">Habilidade 15</button>
      <button class="action" data-msg="Habilidade 16 usada.">Habilidade 16</button>
      <button class="action" data-msg="Habilidade 17 usada.">Habilidade 17</button>
      <button class="action" data-msg="Habilidade 18 usada.">Habilidade 18</button>
      <button class="action" data-msg="Habilidade 19 usada.">Habilidade 19</button>
      <button class="action" data-msg="Habilidade 20 usada.">Habilidade 20</button>
    </section>
  </main>

  <!-- Dialogs laterais -->
  <dialog id="dlgFicha" class="side" aria-labelledby="dlgFichaTitle">
    <div class="dialog-head">
      <h3 id="dlgFichaTitle" class="dialog-title">Ficha técnica</h3>
    </div>
    <div class="dialog-body">
      <label for="txtFicha" class="legend">Edite a ficha técnica:</label>
      <textarea id="txtFicha" placeholder="Digite aqui..." autofocus></textarea>
      <div class="modal-buttons">
        <button class="btn" data-close="dlgFicha">Fechar</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgHistoria" class="side" aria-labelledby="dlgHistoriaTitle">
    <div class="dialog-head">
      <h3 id="dlgHistoriaTitle" class="dialog-title">História</h3>
    </div>
    <div class="dialog-body">
      <label for="txtHistoria" class="legend">Edite a história:</label>
      <textarea id="txtHistoria" placeholder="Digite aqui..." autofocus></textarea>
      <div class="modal-buttons">
        <button class="btn" data-close="dlgHistoria">Fechar</button>
      </div>
    </div>
  </dialog>

  <dialog id="dlgLocal" class="side" aria-labelledby="dlgLocalTitle">
    <div class="dialog-head">
      <h3 id="dlgLocalTitle" class="dialog-title">Localidade Encontrado</h3>
    </div>
    <div class="dialog-body">
      <label for="txtLocal" class="legend">Descreva a localidade:</label>
      <textarea id="txtLocal" placeholder="Digite aqui..." autofocus></textarea>
      <div class="modal-buttons">
        <button class="btn" data-close="dlgLocal">Fechar</button>
      </div>
    </div>
  </dialog>

  <!-- Modal específica: BCC = 20 -->
  <dialog id="dlgDerrota" class="modal" aria-labelledby="dlgDerrotaTitle" aria-modal="true">
    <div class="dialog-head">
      <h3 id="dlgDerrotaTitle" class="dialog-title">HERÓI CANSADO / DERROTADO</h3>
    </div>
    <div class="dialog-body">
      <p class="legend">Escolha uma opção para finalizar:</p>
      <div class="modal-buttons">
        <button class="btn" id="toHospital" type="button" autofocus>Cansado &gt; Enviar para Hospital</button>
        <button class="btn" id="btnDerrotado" type="button">Derrotado</button>
      </div>
    </div>
  </dialog>

  <script>
    // Utilidades
    function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
    function sample(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function clamp(value, min, max) { return Math.min(max, Math.max(min, value)); }

    const output = document.getElementById('output');

    const progSkills = document.getElementById('progSkills');
    const skillsCount = document.getElementById('skills-count');

    const progBcc = document.getElementById('progBcc');
    const bccCount = document.getElementById('bcc-count');

    const incBtn = document.getElementById('inc');
    const decBtn = document.getElementById('dec');
    const fightBtn = document.getElementById('fight');
    const resetBtn = document.getElementById('reset');

    // Dialogs laterais
    const dlgFicha = document.getElementById('dlgFicha');
    const dlgHistoria = document.getElementById('dlgHistoria');
    const dlgLocal = document.getElementById('dlgLocal');

    // Modal de derrota
    const dlgDerrota = document.getElementById('dlgDerrota');
    const toHospitalBtn = document.getElementById('toHospital');
    const derrotadoBtn = document.getElementById('btnDerrotado');

    function updateSkillsDisplay() {
      skillsCount.textContent = `${progSkills.value}/${progSkills.max}`;
      if (Number(progSkills.value) === Number(progSkills.max)) {
        output.textContent = 'Herói usou todas as habilidades; se ainda existem inimigos, utilize o botão Luta.';
      }
    }

    function updateBccDisplay() {
      bccCount.textContent = `${progBcc.value}/${progBcc.max}`;
      progBcc.classList.remove('bcc-azul','bcc-verde','bcc-laranja','bcc-vermelho');
      const v = Number(progBcc.value);
      if (v >= 1 && v <= 5) progBcc.classList.add('bcc-azul');
      else if (v >= 6 && v <= 10) progBcc.classList.add('bcc-verde');
      else if (v >= 11 && v <= 15) progBcc.classList.add('bcc-laranja');
      else if (v >= 16 && v <= 20) progBcc.classList.add('bcc-vermelho');
      incBtn.disabled = v >= Number(progBcc.max);
      decBtn.disabled = v <= 0;
    }

    function openDialog(dlg, focusSelector) {
      if (dlgDerrota.open) return; // bloqueia se modal de derrota aberta
      if (typeof dlg.showModal === 'function') dlg.showModal();
      else dlg.setAttribute('open', '');
      const focusEl = focusSelector ? dlg.querySelector(focusSelector) : null;
      if (focusEl) focusEl.focus();
    }
    function closeDialogById(id) {
      const dlg = document.getElementById(id);
      if (!dlg) return;
      if (typeof dlg.close === 'function') dlg.close();
      else dlg.removeAttribute('open');
    }

    // Verificação de fim de jogo com modal
    function openDerrotaModal() {
      // Desabilita botões fora da modal
      document.querySelectorAll('button').forEach(b => {
        if (!['toHospital','btnDerrotado'].includes(b.id)) b.disabled = true;
      });
      if (typeof dlgDerrota.showModal === 'function') dlgDerrota.showModal();
      else dlgDerrota.setAttribute('open', '');
      output.textContent = 'HERÓI CANSADO / DERROTADO — escolha uma opção.';
    }
    function checkGameOver() {
      const bcc = Number(progBcc.value);
      const skills = Number(progSkills.value);
      if (bcc >= 20 && skills < 20 && !dlgDerrota.open) {
        openDerrotaModal();
      }
    }

    // Habilidades
    document.addEventListener('click', (ev) => {
      const btn = ev.target.closest('button.action');
      if (!btn) return;
      if (dlgDerrota.open) return;
      if (btn.disabled) return;

      const msg = btn.getAttribute('data-msg') || `Você usou: ${btn.textContent.trim()}`;
      output.textContent = msg;

      btn.disabled = true;
      btn.setAttribute('aria-disabled', 'true');

      const next = clamp(Number(progSkills.value) + 1, 0, Number(progSkills.max));
      progSkills.value = next;
      updateSkillsDisplay();
      checkGameOver();
    });

    // Luta
    document.getElementById('fight').addEventListener('click', () => {
      if (dlgDerrota.open) return;
      const palavra = sample(['Ataque', 'Defesa']);
      const numero = randInt(1, 3);
      output.textContent = `Luta: ${palavra} ${numero}.`;
    });

    // Cansaço
    incBtn.addEventListener('click', () => {
      if (dlgDerrota.open) return;
      progBcc.value = clamp(Number(progBcc.value) + 1, 0, Number(progBcc.max));
      updateBccDisplay();
      output.textContent = 'Cansaço +1.';
      checkGameOver();
    });
    decBtn.addEventListener('click', () => {
      if (dlgDerrota.open) return;
      progBcc.value = clamp(Number(progBcc.value) - 1, 0, Number(progBcc.max));
      updateBccDisplay();
      output.textContent = 'Cansaço -1.';
    });

    // Reset
    resetBtn.addEventListener('click', () => {
      if (dlgDerrota.open) return;
      document.querySelectorAll('button.action').forEach(b => {
        b.disabled = false;
        b.removeAttribute('aria-disabled');
      });
      progSkills.value = 0;
      progBcc.value = 0;
      updateSkillsDisplay();
      updateBccDisplay();
      incBtn.disabled = false;
      decBtn.disabled = true;
      document.getElementById('fight').disabled = false;
      resetBtn.disabled = false;
      output.textContent = 'Tudo reiniciado.';
    });

    // Abertura dos dialogs laterais
    document.getElementById('openFicha').addEventListener('click', () => openDialog(dlgFicha, 'textarea'));
    document.getElementById('openHistoria').addEventListener('click', () => openDialog(dlgHistoria, 'textarea'));
    document.getElementById('openLocal').addEventListener('click', () => openDialog(dlgLocal, 'textarea'));

    // Fechar dialogs laterais
    document.querySelectorAll('[data-close]').forEach(btn => {
      btn.addEventListener('click', () => closeDialogById(btn.getAttribute('data-close')));
    });
    [dlgFicha, dlgHistoria, dlgLocal].forEach(d => {
      d.addEventListener('cancel', (e) => { e.preventDefault(); d.close(); });
    });

    // Ações da modal de derrota
    toHospitalBtn.addEventListener('click', () => {
      window.location.href = 'hospital.html';
    });
    derrotadoBtn.addEventListener('click', () => {
      window.close();
      setTimeout(() => {
        if (!document.hidden) window.location.href = 'fim-de-jogo.html';
      }, 250);
    });

    // Inicialização
    updateSkillsDisplay();
    updateBccDisplay();
  </script>
</body>
</html>

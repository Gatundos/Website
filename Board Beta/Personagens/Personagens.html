<!doctype html>
<meta charset="utf-8">
<title>Personagens</title>
<style>
table { border-collapse: collapse; width: 100% }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left }
tr:nth-child(even){ background:#f6f6f6 }
#conteudo { margin-top:16px; border:1px solid #ccc; padding:12px; min-height:200px }
</style>

<table id="tbl">
  <thead>
    <tr>
      <th>Nome</th><th>Título</th><th>Classe</th><th>Clã</th><th>Selecionar</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="conteudo">Selecione um personagem para carregar aqui.</div>

<script>
async function carregarLista() {
  const resp = await fetch('./personagens.json');
  const itens = await resp.json();

  const tbody = document.querySelector('#tbl tbody');
  tbody.innerHTML = '';

  itens.forEach(p => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.nome}</td>
      <td>${p.titulo}</td>
      <td>${p.classe}</td>
      <td>${p.cla}</td>
      <td><a href="${p.arquivo}" data-arquivo="${p.arquivo}">Abrir</a></td>
    `;
    tr.querySelector('a').addEventListener('click', async (e) => {
      e.preventDefault();
      await carregarNoContainer(e.currentTarget.dataset.arquivo);
    });
    tbody.appendChild(tr);
  });
}

async function carregarNoContainer(url) {
  const conteudo = document.getElementById('conteudo');
  try {
    const resp = await fetch(url, { mode: 'same-origin' });
    if (!resp.ok) throw new Error('Falha ao carregar: ' + resp.status);
    const html = await resp.text();
    conteudo.innerHTML = html;
    // Se a página do personagem tiver <script>, eles não executam via innerHTML.
    // Para executar scripts embutidos, recrie-os:
    conteudo.querySelectorAll('script').forEach(old => {
      const s = document.createElement('script');
      if (old.src) { s.src = old.src; } else { s.textContent = old.textContent; }
      document.body.appendChild(s);
      s.remove();
    });
  } catch (err) {
    conteudo.textContent = 'Erro: ' + err.message;
  }
}

carregarLista();
</script>
